{% extends "base.html" %}

{% block content %}

<div class="container mt-4">

    <h2 class="mb-3">üìã Gesti√≥n de √ìrdenes</h2>

    <!-- ================= CONTADOR ================= -->
    <div class="alert alert-warning">
        √ìrdenes pendientes:
        <strong id="contadorPendientes">0</strong>
    </div>

    <!-- ================= BUSCADOR ================= -->
    <input type="text"
           id="buscador"
           class="form-control mb-3"
           placeholder="üîé Buscar cliente o trabajo...">

    <!-- ================= TABLA ================= -->
    <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
            Lista de √ìrdenes
        </div>

        <div class="card-body">

            <table class="table table-striped table-hover align-middle"
                   id="tablaOrdenes">

                <thead class="table-dark">
                    <tr>
                        <th>Cliente</th>
                        <th>Trabajo</th>
                        <th>Total</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>

                <tbody>

                {% for o in ordenes %}
                <tr>

                    <td>{{ o.cliente.nombre }}</td>
                    <td>{{ o.trabajo }}</td>
                    <td><strong>${{ o.total }}</strong></td>

                    <td class="estado">
                        {% if o.estado == "Pendiente" %}
                            <span class="badge bg-warning text-dark">
                                Pendiente
                            </span>
                        {% else %}
                            <span class="badge bg-success">
                                Finalizado
                            </span>
                        {% endif %}
                    </td>

                    <td>

                        <a href="/factura/{{ o.id }}"
                           class="btn btn-success btn-sm"
                           target="_blank">
                           üßæ
                        </a>

                        <!-- BOTON FINALIZAR -->
                        <a href="/finalizar_orden/{{ o.id }}"
                           class="btn btn-warning btn-sm">
                           ‚úÖ
                        </a>

                        <a href="/editar_orden/{{ o.id }}"
                           class="btn btn-primary btn-sm">
                           ‚úè
                        </a>

                        <a href="/eliminar_orden/{{ o.id }}"
                           class="btn btn-danger btn-sm"
                           onclick="return confirm('¬øEliminar esta orden?')">
                           üóë
                        </a>

                    </td>

                </tr>
                {% endfor %}

                </tbody>
            </table>

        </div>
    </div>

</div>

<!-- ================= JAVASCRIPT PRO ================= -->
<script>

//// üîé BUSCADOR EN VIVO
document.getElementById("buscador").addEventListener("keyup", function() {

    let filtro = this.value.toLowerCase();
    let filas = document.querySelectorAll("#tablaOrdenes tbody tr");

    filas.forEach(fila => {
        fila.style.display =
            fila.textContent.toLowerCase().includes(filtro)
            ? ""
            : "none";
    });
});

//// üìä CONTADOR AUTOMATICO
function actualizarContador() {

    let pendientes = document.querySelectorAll(
        ".estado .bg-warning"
    ).length;

    document.getElementById("contadorPendientes")
        .innerText = pendientes;
}

actualizarContador();

</script>

{% endblock %}
